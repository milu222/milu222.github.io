(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{462:function(_,v,t){"use strict";t.r(v);var P=t(1),s=Object(P.a)({},(function(){var _=this,v=_._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[v("h2",{attrs:{id:"一、tcp协议-如何保证页面文件能被完整送达浏览器"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#一、tcp协议-如何保证页面文件能被完整送达浏览器"}},[_._v("#")]),_._v(" 一、TCP协议：如何保证页面文件能被完整送达浏览器")]),_._v(" "),v("p",[_._v("在衡量Web⻚⾯性能的时候有⼀个重要的指标叫“"),v("strong",[_._v("FP（First Paint）")]),_._v("”，是"),v("strong",[_._v("指从⻚⾯加载到⾸次开始绘制的时⻓")]),_._v("。这个指标直接影响了⽤⼾的跳出率，更快的⻚⾯响应意味着更多的PV、更⾼的参与度，以及更⾼的转化率。那什么影响FP指标呢？其中⼀个重要的因素是"),v("strong",[_._v("⽹络加载速度")]),_._v("。")]),_._v(" "),v("p",[_._v("在⽹络中，⼀个⽂件通常会被拆分为很多数据包来进⾏传输，⽽数据包在传输过程中⼜有很⼤概率丢失或者出错。那么"),v("strong",[_._v("如何保证⻚⾯⽂件能被完整地送达浏览器呢")]),_._v("？")]),_._v(" "),v("h3",{attrs:{id:"一个数据包的-旅程"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#一个数据包的-旅程"}},[_._v("#")]),_._v(" ⼀个数据包的“旅程”")]),_._v(" "),v("p",[v("strong",[_._v("互联⽹，实际上是⼀套理念和协议组成的体系架构")]),_._v("。其中，协议是⼀套众所周知的规则和标准，如果各⽅都同意使⽤，那么它们之间的通信将变得毫⽆障碍。")]),_._v(" "),v("p",[_._v("互联⽹中的数据是通过数据包来传输的。如果发送的数据很⼤，那么该数据就会被拆分为很多⼩数据包来传输。⽐如你现在听的⾳频数据，是拆分成⼀个个⼩的数据包来传输的，并不是⼀个⼤的⽂件⼀次传输过来的。")]),_._v(" "),v("h4",{attrs:{id:"_1-ip-把数据包送达目的主机"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-ip-把数据包送达目的主机"}},[_._v("#")]),_._v(" 1. IP：把数据包送达目的主机")]),_._v(" "),v("p",[_._v("数据包要在互联⽹上进⾏传输，就要符合"),v("strong",[_._v("⽹际协议")]),_._v("（Internet Protocol，简称"),v("strong",[_._v("IP")]),_._v("）标准。互联⽹上不同的在线设备都有唯⼀的地址，地址只是⼀个数字，这和⼤部分家庭收件地址类似，你只需要知道⼀个家庭的具体地址，就可以往这个地址发送包裹，这样物流系统就能把物品送到⽬的地。")]),_._v(" "),v("p",[v("strong",[_._v("计算机的地址就称为IP地址，访问任何⽹站实际上只是你的计算机向另外⼀台计算机请求信息。")])]),_._v(" "),v("p",[_._v("如果要想把⼀个数据包从主机A发送给主机B，那么在传输之前，数据包上会被附加上主机B的IP地址信息，这样在传输过程中才能正确寻址。额外地，数据包上还会附加上主机A本⾝的IP地址，有了这些信息主机B才可以回复信息给主机A。这些附加的信息会被装进⼀个叫IP头的数据结构⾥。IP头是IP数据包开头的信息，包含IP版本、源IP地址、⽬标IP地址、⽣存时间等信息。")]),_._v(" "),v("p",[_._v("为了⽅便理解，我先把⽹络简单分为三层结构，如下图：")]),_._v(" "),v("p",[v("img",{attrs:{src:"https://doc.panjingyi.top/blog/202207012149241.jpg",alt:"img"}})]),_._v(" "),v("p",[_._v("下⾯我们⼀起来看下⼀个数据包从主机A到主机B的旅程：")]),_._v(" "),v("ul",[v("li",[_._v("上层将含有“极客时间”的数据包交给⽹络层；")]),_._v(" "),v("li",[_._v("⽹络层再将IP头附加到数据包上，组成新的 IP数据包，并交给底层；")]),_._v(" "),v("li",[_._v("底层通过物理⽹络将数据包传输给主机B；")]),_._v(" "),v("li",[_._v("数据包被传输到主机B的⽹络层，在这⾥主机B拆开数据包的IP头信息，并将拆开来的数据部分交给上层；")]),_._v(" "),v("li",[_._v("最终，含有“极客时间”信息的数据包就到达了主机B的上层了。")])]),_._v(" "),v("h4",{attrs:{id:"_2-udp-把数据包送达应用程序"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-udp-把数据包送达应用程序"}},[_._v("#")]),_._v(" 2. UDP：把数据包送达应⽤程序")]),_._v(" "),v("p",[_._v("IP是⾮常底层的协议，只负责把数据包传送到对⽅电脑，但是对⽅电脑并不知道把数据包交给哪个程序，是交给浏览器还是交给王者荣耀？因此，"),v("strong",[_._v("需要基于IP之上开发能和应⽤打交道的协议，最常⻅的是“⽤⼾数据包协议（User Datagram Protocol）”，简称UDP。")])]),_._v(" "),v("p",[_._v("UDP中⼀个最重要的信息是"),v("strong",[_._v("端⼝号")]),_._v("，端⼝号其实就是⼀个数字，每个想访问⽹络的程序都需要绑定⼀个端⼝号。通过端⼝号UDP就能把指定的数据包发送给指定的程序了，所以"),v("strong",[_._v("IP通过IP地址信息把数据包发送给指定的电脑，⽽UDP通过端⼝号把数据包分发给正确的程序")]),_._v("。和IP头⼀样，端⼝号会被装进UDP头⾥⾯，UDP头再和原始数据包合并组成新的UDP数据包。UDP头中除了⽬的端⼝，还有源端⼝号等信息。")]),_._v(" "),v("p",[_._v("为了⽀持UDP协议，我把前⾯的三层结构扩充为四层结构，在⽹络层和上层之间增加了传输层，如下图所示：")]),_._v(" "),v("p",[v("img",{attrs:{src:"https://doc.panjingyi.top/blog/202207012149242.jpg",alt:"img"}})]),_._v(" "),v("p",[_._v("下⾯我们⼀起来看下⼀个数据包从主机A旅⾏到主机B的路线：")]),_._v(" "),v("ul",[v("li",[_._v("上层将含有“极客时间”的数据包交给传输层；")]),_._v(" "),v("li",[_._v("传输层会在数据包前⾯附加上UDP头，组成新的UDP数据包，再将新的UDP数据包交给⽹络层；")]),_._v(" "),v("li",[_._v("⽹络层再将IP头附加到数据包上，组成新的IP数据包，并交给底层；")]),_._v(" "),v("li",[_._v("数据包被传输到主机B的⽹络层，在这⾥主机B拆开IP头信息，并将拆开来的数据部分交给传输层；")]),_._v(" "),v("li",[_._v("在传输层，数据包中的UDP头会被拆开，并根据UDP中所提供的端⼝号，把数据部分交给上层的应⽤程序；")]),_._v(" "),v("li",[_._v("最终，含有“极客时间”信息的数据包就旅⾏到了主机B上层应⽤程序这⾥。")])]),_._v(" "),v("p",[_._v("在使⽤UDP发送数据时，有各种因素会导致数据包出错，虽然UDP可以校验数据是否正确，但是对于错误的数据包，UDP并不提供重发机制，只是丢弃当前的包，⽽且UDP在发送之后也⽆法知道是否能达到⽬的地。")]),_._v(" "),v("p",[v("strong",[_._v("虽说UDP不能保证数据可靠性，但是传输速度却⾮常快")]),_._v("，所以UDP会应⽤在⼀些关注速度、但不那么严格要求数据完整性的领域，如在线视频、互动游戏等。")]),_._v(" "),v("h4",{attrs:{id:"_3-tcp-把数据完整地送达应用程序"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_3-tcp-把数据完整地送达应用程序"}},[_._v("#")]),_._v(" 3. TCP：把数据完整地送达应⽤程序")]),_._v(" "),v("p",[_._v("对于浏览器请求，或者邮件这类要求数据传输可靠性（reliability）的应⽤，如果使⽤UDP来传输会存在两个问题：")]),_._v(" "),v("ul",[v("li",[_._v("数据包在传输过程中容易丢失；")]),_._v(" "),v("li",[_._v("⼤⽂件会被拆分成很多⼩的数据包来传输，这些⼩的数据包会经过不同的路由，并在不同的时间到达接收端，⽽UDP协议并不知道如何组装这些数据包，从⽽把这些数据包还原成完整的⽂件。")])]),_._v(" "),v("p",[_._v("基于这两个问题，我们引⼊TCP了。TCP（Transmission Control Protocol，传输控制协议）是⼀种⾯向连接的、可靠的、基于字节流的传输层通信协议。相对于UDP，TCP有下⾯两个特点:")]),_._v(" "),v("ul",[v("li",[_._v("对于数据包丢失的情况，TCP提供重传机制；")]),_._v(" "),v("li",[_._v("TCP引⼊了数据包排序机制，⽤来保证把乱序的数据包组合成⼀个完整的⽂件。")])]),_._v(" "),v("p",[_._v("和UDP头⼀样，TCP头除了包含了⽬标端⼝和本机端⼝号外，还提供了⽤于排序的序列号，以便接收端通过序号来重排数据包。")]),_._v(" "),v("p",[_._v("下⾯看看TCP下的单个数据包的传输流程：")]),_._v(" "),v("p",[v("img",{attrs:{src:"https://doc.panjingyi.top/blog/202207012149243.jpg",alt:"img"}})]),_._v(" "),v("p",[_._v("TCP单个数据包的传输流程和UDP流程差不多，不同的地⽅在于，通过TCP头的信息保证了⼀块⼤的数据传输的完整性。")]),_._v(" "),v("p",[_._v("从下图可以看出，⼀个完整的TCP连接的⽣命周期包括了“"),v("strong",[_._v("建⽴连接")]),_._v("”“"),v("strong",[_._v("传输数据")]),_._v("”和“"),v("strong",[_._v("断开连接")]),_._v("”三个阶 段。")]),_._v(" "),v("p",[v("img",{attrs:{src:"https://doc.panjingyi.top/blog/202207012149244.jpg",alt:"img"}})]),_._v(" "),v("ul",[v("li",[_._v("⾸先，建⽴连接阶段。这个阶段是通过“三次握⼿”来建⽴客⼾端和服务器之间的连接。TCP 提供⾯向连接的通信传输。⾯向连接是指在数据通信开始之前先做好两端之间的准备⼯作。所谓三次握⼿，是指在建⽴⼀个TCP连接时，客⼾端和服务器总共要发送三个数据包以确认连接的建⽴。")]),_._v(" "),v("li",[_._v("其次，传输数据阶段。在该阶段，接收端需要对每个数据包进⾏确认操作，也就是接收端在接收到数据包之后，需要发送确认数据包给发送端。所以当发送端发送了⼀个数据包之后，在规定时间内没有接收到接收端反馈的确认消息，则判断为数据包丢失，并触发发送端的重发机制。同样，⼀个⼤的⽂件在传输过程中会被拆分成很多⼩的数据包，这些数据包到达接收端后，接收端会按照TCP头中的序号为其排序，从⽽保证组成完整的数据。")]),_._v(" "),v("li",[_._v("最后，断开连接阶段。数据传输完毕之后，就要终⽌连接了，涉及到最后⼀个阶段“四次挥⼿”来保证双⽅都能断开连接。")])]),_._v(" "),v("p",[_._v("TCP为了保证数据传输的可靠性，牺牲了数据包的传输速度，因为“三次握⼿”和“数据包校验机制”等把传输过程中的数据包的数量提⾼了⼀倍。")]),_._v(" "),v("h3",{attrs:{id:"总结"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[_._v("#")]),_._v(" 总结")]),_._v(" "),v("ul",[v("li",[_._v("互联⽹中的数据是通过数据包来传输的，数据包在传输过程中容易丢失或出错。")]),_._v(" "),v("li",[_._v("IP负责把数据包送达⽬的主机。")]),_._v(" "),v("li",[_._v("UDP负责把数据包送达具体应⽤。")]),_._v(" "),v("li",[_._v("⽽TCP保证了数据完整地传输，它的连接可分为三个阶段：建⽴连接、传输数据和断开连接。")])]),_._v(" "),v("blockquote",[v("p",[_._v("你怎么理解HTTP和TCP的关系？")]),_._v(" "),v("p",[_._v("HTTP协议和TCP协议都是TCP/IP协议簇的⼦集。 HTTP协议属于应⽤层，TCP协议属于传输层，HTTP协议位于TCP协议的上层。 请求⽅要发送的数据包，在应⽤层加上HTTP头以后会交给传输层的TCP协议处理，应答⽅接收到的数据包，在传输层拆掉TCP头以后交给应⽤层的HTTP协议处理。建⽴ TCP 连接后会顺序收发数据，请求⽅和应答⽅都必须依据 HTTP 规范构建和解析HTTP报⽂。")]),_._v(" "),v("p",[_._v("tcp是个梯⼦，http就是利⽤梯⼦来搬运货物")])])])}),[],!1,null,null,null);v.default=s.exports}}]);